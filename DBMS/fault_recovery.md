#ログの種類
ログには、更新前ログと更新後ログの二種類がある。

#データの更新タイミング
データベースへの変更があると、まずメモリ上でデータベースが変更される。ハードディスクのデータベースの情報の更新は、**チェックポイント**で行われる。

また、データベースへの変更があると、メモリ上のログバッファで変更前ログと変更後ログが更新され、その情報が、ログファイルとしてハードディスクに書きだされる。

順番としては、ログファイルへの書き出し　ー＞　チェックポイントでの変更への反映

#ロールバックとロールフォワード
更新前ログを用いてなされるのがロールバック。
更新後ログを用いてなされるのがロールフォワード

#WALプロトコル
データの変更に先立って、ログの書き出しが行われる方法をWAL(Write Ahead Log)プロトコルという。

トランザクションの原子性、耐久性と、ログの関係。トランザクションの障害回復の基本は、コミットされていないトランザクションはUndo、コミットされたトランザクションはRedoする。

Undoのために、トランザクションが始まる前のログが必要。Redoのために、トランザクションが終わった時のログが必要。

トランザクションがコミットされた時、まずログの書き込みを行う??????

コミットする直前に、該当トランザクションのデータ更新をログに書き出す

##平成24年春 データベーススペシャリスト午前2 問17
WALに従った処理の順序

1. begin transaction レコードを書き出す
2. ログに更新前レコードを書き出す
3. ログに更新後レコードを書き出す
4. データベースを更新する
5. commitレコードを書き出す
6. end transactionレコードを書き出す

#障害の種類
障害には、

- トランザクション障害
- ソフトウェア障害
- ハードウェア障害

の三種類がある。

##トランザクション障害
トランザクションの途中で不具合が興るなど、DBMSのなかでの障害。

######具体的に、どういう理由でトランザクション障害が起こるんだろう？トランザクション障害は、ソフトウェア障害とハードウェア障害とは独立したものなのか?ソフトウェアもハードウェアも無事なのに、トランザクションが成立しないってどういう状況？トランザクションが集中することによる過負荷とか?

DBMSが正常に働いているので、DBMSが処理をする。ロールバックによる回復。これは、トランザクションのAtomic特性を考えれば当然。

##ソフトウェア障害
DBMSやアプリケーションに障害が八世、処理が停止すること。
######電源が落ちることもソフトウェア障害?なんで?ハードが壊れるわけではないから?

コミットの状態に応じて、ロールバック処理あるいはロールフォワード処理を行う。

つまり、コミット成立してれば、ログに残ってる差分でロールフォワードするべきだし、コミット成立してなければ、ロールバックするべき。これも、結局トランザクションの原子性からくること。

##ハードウェア障害
ハードウェア障害についても、トランザクションのAtomic特性を考慮してロールバック、ロールフォワードを行う、というのは同じ。