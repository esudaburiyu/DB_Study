[DBアタマアカデミー](http://gihyo.jp/dev/serial/01/db-academy/000203)

#モチベーション
データベースは通常、複数のユーザーに同時にアクセスされる。このときも、データベースが問題なく動いてくれることを保証したい。

また、DBでトランザクションを処理するとき、複数のトランザクションを同時実行できるようにしたい。

そこで、トランザクションの独立性とか、二相ロックとかの話が出てくる。

#ロック
ロックには、共有ロックと占有ロックがある。

共有ロックは、読み取りのとき。読んでいるデータを、読んでいる途中に変更されてしまうと困るので、自分がデータを読んでいる間は、そのデータの変更がなされないようにする。ただし、自分が読んでいるデータを、同時に他の人が読んでいても、問題ない。だから、共有ロックと共有ロックは共存可能。

占有ロックは、書き込みのとき。書き込み途中のデータは、誰かに読み出しをされても問題だし、書き込みをされても問題。だから、自分以外には読み書きできないようにする。

#直列化可能性と同時実行可能性
直列化可能性とは、トランザクションAとBを同時に実行しても、順次実行したときと同じ結果が得られること。

一方で、トランザクションAとBが、最初と最後に同じデータにロック、アンロックをしていたとしたら、そもそもAとBは同時に実行することが実質できない。

すなわち、同時実行不可能ならば、直列化可能。
しかし、直列化可能ならば同時実行不可能、とも言えないだろう。

たとえば、トランザクションAとBで、影響範囲が全然重なってなければ、同時実行可能だし、直列化も可能。

しかし、これらは状況が単純すぎる。一般に、トランザクションAとBが直列化可能であるかどうか、簡単に見分ける方法がないものか……。

######24春午前２問19がよくわからん……。

##ちょっと、直列化可能性の定義を突っ込んで考える
直列化可能性 = 並列に実行しても、逐次実行した時と、**同じ結果**を得ることができること

では、**同じ結果**とは何か?
=> ビュー等価と競合等価

##ビュー等価と競合等価
ビュー等価性の判定は、NP困難。よって、競合等価について判定するのが一般的。競合等価については、先行グラフというものを書く。

######二相ロックを守れば直列可能????

#二相ロック
二相ロックとは、rockとunrockの順番について、必要な資源をrockするまでunrockを行わない、ということ

どういうことか? つまり、
rock -> rock -> rock -> unrock -> unrock -> unrock
というのはOKで
rock -> unrock -> rock -> unrock -> rock -> unrock
というのはだめ

単調増加からの、単調減少

ロックし続ける、そののちに、アンロックし続ける。

######なんでこれによって、直列可能性が保証される???

######二相ロックで、別にデットロックは防げない
