#CAP定理について

#分散データベースとは
分散データベースは、**複数のDBMS**からなる

#分散データベースの等価性
- 位置に対する透過性

データが物理的にどこにカクノされていても、ユーザーはそのことを意識しなくていい、ということ

- 分割に対する透過性

データ、たとえばファイルを分割していても、ユーザーはそれを意識しなくていい、ということ

- 複製に対する透過性

データは、複製されていても、ユーザーにはひとつのファイルに見える、ということ。

#2相コミット
複数のDBMSからなるので、コミットも一筋縄ではいかない。
モチベーションとしては、分散データベースにおいても、トランザクションの原子性を保証する、ということ


##第一相
調停者が、DBMSのなかで同意をとる

##第二層
みんなから同意を得られたら、コミットをする。

##2相コミットの弱点
参加者のDBMSは、調停者から第一相にて、コミットの可否問い合わせがあると、トランザクションに必要な処理を行い、それが成功したら、コミットの直前の状態で、調停者にコミットの可を伝えて待状態になる。

ここから、参加者は調停者からの第二相のコミット命令を待ち続ける。このときは、トランザクションのために確保した資源はロックし続ける。もしこの状態で、調停者が死んだりしたら、永遠に待ち続けることになる。

######参加者は、調停者にコミットが可能か否かを伝える。応答しない参加者がいた時、調停者はどのように対応するのか?

Wikipediaによれば、調停者はタイムアウトを発生させて、ロールバック命令で対応するようだ

######2相コミットに対して思うこと
2相コミットは、参加者のDBMSが、コミットの可否を調停者に送信することで協調を行おうとしている。これって、ネットワークの障害に対して、あまり考慮してないアルゴリズムに思える。つまり、2相コミットは、トランザクション障害に備えたアルゴリズムで、DBMS自体が死ぬことや、ネットワークが死ぬことに対する備えがあんまり見えてこない。

#分散データベースでのコミットについて、ゼロベースで考えてみる


